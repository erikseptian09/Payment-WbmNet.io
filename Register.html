<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Daftar Langganan - Wibawamulia.Network</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

  <style>
    body {
      background: url('wbm1.jpg') no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: 'Segoe UI', sans-serif;
    }
    .register-card {
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
      padding: 30px;
      max-width: 450px;
      width: 100%;
      animation: fadeIn 0.8s ease-in-out;
    }
    .register-card h2 {
      font-weight: 700;
      margin-bottom: 20px;
      color: #0d6efd;
    }
    .form-control, .form-select {
      border-radius: 10px;
      margin-bottom: 15px;
    }
    .btn-register {
      background: #0d6efd;
      border: none;
      border-radius: 10px;
      padding: 12px;
      font-size: 16px;
      font-weight: 600;
      transition: 0.3s;
    }
    .btn-register:hover {
      background: #0bb2ff;
      transform: translateY(-2px);
    }
    @keyframes fadeIn {
      from {opacity:0; transform: translateY(20px);}
      to {opacity:1; transform: translateY(0);}
    }
  </style>
</head>
<body>

  <!-- FORM REGISTER -->
  <div class="register-card" id="formRegister">
    <h2 class="text-center"><i class="fas fa-user-plus"></i> Daftar Langganan</h2>
    <p class="text-center text-muted">Isi data berikut untuk mulai berlangganan internet.</p>
    
    <input type="text" id="nama" class="form-control" placeholder="üë§ Nama Lengkap">
    <input type="text" id="alamat" class="form-control" placeholder="üè† Alamat Lengkap">
    <input type="text" id="telepon" class="form-control" placeholder="üì± Nomor HP (contoh: 08123456789)">
    
    <select id="paket" class="form-select" onchange="tampilkanHarga()">
      <option value="" disabled selected>üì¶ Pilih Paket</option>
      <option value="Paket Basic">Paket Basic - 5 Mbps</option>
      <option value="Paket Standard">Paket Family - 7 Mbps</option>
      <option value="Paket Premium">Paket Profesional - 10 Mbps</option>
    </select>

    <!-- Harga muncul setelah pilih paket -->
    <div id="hargaPaket" class="text-center mt-2 fw-bold text-primary"></div>

    <button onclick="daftarPelanggan()" class="btn btn-register w-100">
      <i class="fas fa-paper-plane"></i> Daftar Sekarang
    </button>
  </div>

  <!-- POPUP SUKSES -->
  <div class="modal fade" id="popupSukses" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content text-center p-4">
        <i class="fas fa-check-circle text-success" style="font-size: 60px;"></i>
        <h4 class="mt-3">Pendaftaran Berhasil!</h4>
        <p>Terima kasih telah mendaftar di <b>Wibawamulia.Network</b>.</p>
        <button class="btn btn-primary" data-bs-dismiss="modal">OK</button>
      </div>
    </div>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Firebase A
  const firebaseConfigA = {
    apiKey: "AIzaSyAJ2m4MOTQxw9VgY4IdIO9_E6fiX-9G9VY",
    authDomain: "paymentpelanggan.firebaseapp.com",
    databaseURL: "https://paymentpelanggan-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "paymentpelanggan",
    storageBucket: "paymentpelanggan.appspot.com",
    messagingSenderId: "788101237037",
    appId: "1:788101237037:web:5206ab2fe12a958fa42ba4",
    measurementId: "G-PJCYE6RDZJ"
  };
  const appA = firebase.initializeApp(firebaseConfigA, "appA");
  const dbA = appA.database();

  // Firebase B
  const firebaseConfigB = {
    apiKey: "AIzaSyBXnXCSXhy06eqWBPzYmzxCo_LBzl51DO4",
    authDomain: "wibawamulianetwork.firebaseapp.com",
    databaseURL: "https://wibawamulianetwork-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "wibawamulianetwork",
    storageBucket: "wibawamulianetwork.appspot.com",
    messagingSenderId: "605020393823",
    appId: "1:605020393823:web:6ba8afe7e250bc004da6ea"
  };
  const appB = firebase.initializeApp(firebaseConfigB, "appB");
  const dbB = appB.database();

  // WA
  function bukaWA(nomorAdmin, pesan) {
    const link = document.createElement('a');
    link.href = `https://wa.me/${nomorAdmin}?text=${pesan}`;
    link.target = "_blank";
    link.rel = "noopener noreferrer";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  // Harga tampil otomatis
  function tampilkanHarga() {
    const paket = document.getElementById('paket').value;
    const hargaDiv = document.getElementById('hargaPaket');
    const hargaMap = {
      "Paket Basic": "Rp150.000 / bulan",
      "Paket Standard": "Rp170.000 / bulan",
      "Paket Premium": "Rp200.000 / bulan"
    };
    hargaDiv.innerHTML = hargaMap[paket] ? "üí∞ " + hargaMap[paket] : '';
  }

  // Proses daftar
  function daftarPelanggan() {
    const nama = document.getElementById('nama').value.trim();
    const alamat = document.getElementById('alamat').value.trim();
    const telepon = document.getElementById('telepon').value.trim();
    const paket = document.getElementById('paket').value;

    const hargaMap = {
      "Paket Basic": "150000",
      "Paket Standard": "170000",
      "Paket Premium": "200000"
    };
    const harga = hargaMap[paket] || "0";

    if (!nama || !alamat || !telepon || !paket) {
      alert("‚ö†Ô∏è Lengkapi semua field!");
      return;
    }

    // Simpan ke Firebase A
    dbA.ref('pendaftaran').push({ nama, alamat, telepon, paket, harga });

    // Simpan ke Firebase B
    dbB.ref('pelanggan').push({ 
      nama, 
      paket, 
      keterangan: alamat + " | " + telepon, 
      harga 
    });

    // Kirim WA + Google Sheets
    const nomorAdmin = "6285817230536";
    const pesan = `Hai, saya mau daftar langganan di Wbm.Net%0A%0A` +
                  `Nama: ${nama}%0A` +
                  `Alamat: ${alamat}%0A` +
                  `No HP: ${telepon}%0A` +
                  `Paket: ${paket}%0A` +
                  `Harga: Rp${harga}`;
    bukaWA(nomorAdmin, pesan);

    fetch("https://script.google.com/macros/s/AKfycbwcKStHqFHxAofS5Ia6lEqZADbiJCXhI2tGJDMeh4u9kMPlLgBzGPRXA_TGupJJS6zb/exec", {
      method: "POST",
      body: JSON.stringify({ nama, alamat, telepon, paket, harga }),
      headers: { "Content-Type": "application/json" }
    });

    // Sembunyikan form + tampil popup sukses
    document.getElementById('formRegister').style.display = "none";
    var myModal = new bootstrap.Modal(document.getElementById('popupSukses'));
    myModal.show();
  }
</script>
</body>
</html>
