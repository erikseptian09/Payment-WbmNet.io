<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Daftar Langganan</title>
  <link rel="stylesheet" href="billing.css">
</head>
<body>
  <div class="container">
    <h2>Form Pendaftaran Langganan</h2>

    <input type="text" id="nama" placeholder="Nama Lengkap">
    <input type="text" id="alamat" placeholder="Alamat Lengkap">
    <input type="text" id="telepon" placeholder="Nomor HP (contoh: 08123456789)">
    
    <select id="paket">
      <option value="" disabled selected>Pilih Paket</option>
      <option value="Paket Basic">Paket Basic</option>
      <option value="Paket Standard">Paket Family</option>
      <option value="Paket Premium">Paket Profesional</option>
    </select>

    <button onclick="daftarPelanggan()">Daftar</button>
    <p id="status" style="text-align:center; margin-top:10px;"></p>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="config.js"></script>

<script>
  const db = firebase.database();

  // Fungsi aman untuk buka WA di PWA
  function bukaWA(nomorAdmin, pesan) {
    const link = document.createElement('a');
    link.href = `https://wa.me/${nomorAdmin}?text=${pesan}`;
    link.target = "_blank";
    link.rel = "noopener noreferrer";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function daftarPelanggan() {
    const nama = document.getElementById('nama').value.trim();
    const alamat = document.getElementById('alamat').value.trim();
    const telepon = document.getElementById('telepon').value.trim();
    const paket = document.getElementById('paket').value;
    const harga = paket === 'Paket Basic' ? 150000 :
                  paket === 'Paket Family' ? 170000 :
                  paket === 'Paket Profesional' ? 200000 : 0;

    if (!nama || !alamat || !telepon || !paket) {
      document.getElementById('status').innerText = '⚠️ Lengkapi semua field!';
      return;
    }

    // Kirim WA langsung (supaya tidak tergantung kecepatan Firebase)
    const nomorAdmin = "6285817230536"; // Ganti dengan nomor admin
    const pesan = `Halo Admin,%0ASaya ingin mendaftar:%0A%0ANama: ${nama}%0AAlamat: ${alamat}%0ANo HP: ${telepon}%0APaket: ${paket}%0AHarga: Rp${harga.toLocaleString('id-ID')}`;
    bukaWA(nomorAdmin, pesan);

    // Simpan ke Firebase (jalan di background)
    const data = {
      nama,
      alamat,
      telepon,
      paket,
      harga,
      status: 'Aktif',
      tanggal_daftar: new Date().toLocaleString('id-ID')
    };
    db.ref('pelanggan').push(data);

    // Reset form
    document.getElementById('nama').value = '';
    document.getElementById('alamat').value = '';
    document.getElementById('telepon').value = '';
    document.getElementById('paket').value = '';
    document.getElementById('status').innerText = '✅ Pendaftaran berhasil!';
  }
</script>
</body>
</html>
