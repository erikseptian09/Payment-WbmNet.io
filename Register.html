<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Daftar Langganan</title>
  <link rel="stylesheet" href="billing.css">
</head>
<body>
  <div class="container">
    <h2>Form Pendaftaran Langganan</h2>

    <input type="text" id="nama" placeholder="Nama Lengkap">
    <input type="text" id="alamat" placeholder="Alamat Lengkap">
    <input type="text" id="telepon" placeholder="Nomor HP (contoh: 08123456789)">
    
    <select id="paket">
      <option value="" disabled selected>Pilih Paket</option>
      <option value="Paket Basic">Paket Basic 5Mbps</option>
      <option value="Paket Standard">Paket Family 7Mbps</option>
      <option value="Paket Premium">Paket Profesional 10Mbps</option>
    </select>

    <button onclick="daftarPelanggan()">Daftar</button>
    <p id="status" style="text-align:center; margin-top:10px;"></p>
  </div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="config.js"></script>

<script>
  // Fungsi aman untuk buka WA di PWA
  function bukaWA(nomorAdmin, pesan) {
    const link = document.createElement('a');
    link.href = `https://wa.me/${nomorAdmin}?text=${pesan}`;
    link.target = "_blank";
    link.rel = "noopener noreferrer";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }

  function daftarPelanggan() {
    const nama = document.getElementById('nama').value.trim();
    const alamat = document.getElementById('alamat').value.trim();
    const telepon = document.getElementById('telepon').value.trim();
    const paket = document.getElementById('paket').value;

    if (!nama || !alamat || !telepon || !paket) {
      document.getElementById('status').innerText = '⚠️ Lengkapi semua field!';
      return;
    }

    // 1. Kirim ke WhatsApp
    const nomorAdmin = "6285817230536"; // Ganti nomor admin
    const pesan = `Hai, saya mau daftar langganan di Wbm.Net%0A%0A` +
                  `Nama: ${nama}%0A` +
                  `Alamat: ${alamat}%0A` +
                  `No HP: ${telepon}%0A` +
                  `Paket: ${paket}`;
    bukaWA(nomorAdmin, pesan);

    // 2. Kirim ke Google Sheets via Apps Script Web App
    fetch("https://script.google.com/macros/s/AKfycbzx_Kj9bUoAPVrBQkeUHeEP-uRHX3sshkxJvAlBFDp_tzQyXHR1CDqmCoyBfA0SX9XpoQ/exec", { // Ganti dengan URL Web App dari Apps Script
      method: "POST",
      body: JSON.stringify({ nama, alamat, telepon, paket }),
      headers: { "Content-Type": "application/json" }
    });

    // Reset form
    document.getElementById('nama').value = '';
    document.getElementById('alamat').value = '';
    document.getElementById('telepon').value = '';
    document.getElementById('paket').value = '';
    document.getElementById('status').innerText = '✅ Pendaftaran berhasil!';
  }
</script>
</body>
</html>
